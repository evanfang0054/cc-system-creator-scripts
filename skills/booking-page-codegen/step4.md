# 步骤4：代码整合与PRD验收

**触发条件**：'current_step = 4'，已完成数据和交互逻辑设计

**前置准备（关键）**：
```bash
# 必须首先读取任务计划和研究笔记，获取完整的研究上下文
# 注意：路径占位符 `/path/to/booking/` 应替换为实际目录
Read /path/to/booking/task_plan.md
Read /path/to/booking/research_notes.md
```

**目的**：
- 确保代码整合与原始需求一致（从 task_plan.md 获取）
- 获取所有研究成果（API 文档、组件 API、设计决策等）
- 在上下文窗口中保持完整的设计信息，确保代码正确性

**路径占位符说明**：
- 提供的静态模板路径如 `/Users/user/project/pages/booking/index.tsx`
- 则 `/path/to/booking/` 替换为 `/Users/user/project/pages/booking/`

**主要行动**:

1. **代码整合与生成**
   - 将步骤 2 和步骤 3 设计的逻辑，完整地补全到用户的静态模板代码中
   - 确保保留原有的样式类名（Tailwind CSS）和 DOM 结构
   - 移除所有 TODO 注释，替换为实际的业务逻辑代码

2. **PRD 功能验收**

   **验收来源**：从 `research_notes.md` 的 "PRD 理解与拆解" → "功能清单（验收标准）" 部分获取所有功能点

   **验收流程**：
   a. 逐条读取功能清单中的每个功能点
   b. 在生成的代码中验证该功能是否已正确实现
   c. 标记验收状态：
      - ✅ 已正确实现
      - ⚠️  部分实现，需要补充
      - ❌ 未实现，需要添加
   d. 对于未通过验收的功能，立即修正代码
   e. 重复验收直到所有功能点都通过 ✅

   **验收示例**（参考格式，实际验收基于 research_notes.md）：
   - [ ] **功能点1**: 初始化预订表单 - ✅ 已实现
   - [ ] **功能点2**: 选择访问日期 - ✅ 已实现
   - [ ] **功能点3**: 选择进入时间 - ⚠️ 需补充联动逻辑
   - [ ] **功能点N**: [功能描述] - [状态]

   **验收记录**：将验收结果和修正过程记录到 `research_notes.md` 的 "PRD 理解与拆解" → "功能清单" 部分，更新每个功能点的完成状态

**步骤完成后的行动（重要）**：

1. **更新 task_plan.md**：

   ```bash
   Edit /path/to/booking/task_plan.md
   ```

   - 标记阶段 4 为完成：`- [x] 阶段 4：代码整合与 PRD 验收`
   - 在"遇到的错误"部分记录代码整合过程中的问题及解决方案
   - 更新状态为："**当前处于阶段 5** - 准备最终测试验证"

2. **告知用户并自动进入步骤5**：
   - 明确告知用户："✅ 步骤4已完成，现在自动进入步骤5：测试用例验收与最终验证"
   - 直接开始执行步骤5，无需用户再次触发
