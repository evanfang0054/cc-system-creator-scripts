# 第 4 步：代码整合与 PRD 验证

## 目标

通过整合所有设计的逻辑生成完整的预订页面实现，并根据 PRD 要求进行验证。

## 行动

### 1. 代码整合与生成

#### 合并实现逻辑
- 将第 2 步数据层设计集成到静态模板中
- 添加第 3 步交互逻辑和组件实现
- 保留现有的 Tailwind CSS 类和 DOM 结构
- 将所有 TODO 注释替换为实际业务逻辑代码

#### 代码结构实现
- 添加所有必要的导入和依赖
- 实现与 `useBookingStore` 的存储集成
- 添加 API 集成函数
- 为所有用户交互创建事件处理程序
- 实现表单验证和错误处理

#### 组件实现
- 基于文档研究添加缺失的组件逻辑
- 为所有表单字段实现适当的状态管理
- 添加加载状态和错误边界
- 确保整个过程中的适当 TypeScript 类型

### 2. PRD 要求验证

重新阅读: [references/prd.md](references/prd.md)

#### Gherkin 场景验证
检查每个场景的完整实现：

✅ **场景：初始化预订表单**
- maxPassengers 的 URL 参数解析
- 预订策略集成
- 表单字段初始化
- 可用日期 API 调用

✅ **场景：日期选择**
- 仅显示可用日期的日期选择器
- 日期格式验证 (yyyy-mm-dd)
- 日期更改时时间选择器重置
- 时间段可用性 API 触发

✅ **场景：时间选择**
- 仅显示可用时间段的时间选择器
- 时间格式验证 (hh:mm)
- 选择后的正确时间显示

✅ **场景：动态乘客姓名**
- 动态乘客字段生成
- 最大乘客数限制强制执行
- 输入验证和格式化

✅ **场景：动态字段验证**
- 基于预订必需信息的字段可见性
- 必填字段验证
- 实时验证反馈

✅ **场景：数据持久化**
- 存储数据管理
- 表单状态保留
- 卸载时数据清理

✅ **场景：表单验证和按钮状态**
- 完整的表单验证逻辑
- 按钮状态管理
- 错误消息显示

✅ **场景：导航到结账**
- 导航前数据持久化
- 页面转换的 JSBridge 集成
- 适当的错误处理

## 验证标准

✅ **代码整合完成**：
- 所有 TODO 注释已替换
- 适当的导入和依赖
- 清洁、可维护的代码结构
- TypeScript 类型安全

✅ **PRD 要求满足**：
- 所有 Gherkin 场景已实现
- 业务逻辑正确实现
- 用户体验要求满足
- 错误处理全面

✅ **代码质量标准满足**：
- 遵循 [references/codingspec.md](references/codingspec.md)
- 适当的错误处理
- 性能考虑
- 可访问性合规

## 下一步

继续 [第 5 步](step5.md)：测试与最终验证

**输出确认**: "代码整合完成 - 所有 PRD 要求已实现"
