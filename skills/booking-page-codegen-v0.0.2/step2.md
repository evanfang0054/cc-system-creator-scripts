# 第 2 步：API 集成与数据逻辑设计

## 目标

基于第 1 步的需求分析，设计完整的数据层实现和 API 集成。

## 行动

### 1. 阅读 API 文档

- 完全阅读: [references/api-docs.md](references/api-docs.md)
- 完全阅读: [references/api-request.md](references/api-request.md)
- 理解所有可用端点及其用途

### 2. 获取 API 架构

**关键**: 在未获取实际架构的情况下，永远不要假设 API 参数或响应。

对于 `api-docs.md` 中提到的每个 API 端点：

```bash
# 使用 WebFetch 获取详细的 API 文档
WebFetch [API_DOCUMENTATION_URL]
```

**需要获取的架构**:
- 日期可用性端点
- 时间段可用性端点
- 乘客验证端点
- 预订提交端点
- 资源详情端点

### 3. 设计数据层架构

#### API 请求函数
- 基于 `api-request.md` 标准
- 创建可重用的 API 客户端函数
- 实现适当的错误处理
- 添加请求/响应拦截器

#### 状态管理设计
- 规划 `useBookingStore` 数据结构：
  - 资源详情存储
  - 预订策略管理
  - 可用日期和时间段
  - 表单数据和验证状态
  - 加载和错误状态

#### 数据流实现
- 在 `useEffect` 中设计初始化序列
- 规划数据刷新策略
- 在适当的地方实现乐观更新
- 处理竞态条件和并发请求

### 4. 类型定义

为以下内容定义 TypeScript 接口：
- API 请求参数
- API 响应类型
- 存储状态结构
- 表单数据模型
- 错误类型

## 验证标准

✅ **API 文档完成**：
- 所有端点已理解
- 架构已获取并验证
- 请求/响应模式清晰

✅ **数据层设计完成**：
- API 函数已规划
- 状态结构已定义
- 数据流已映射
- 错误处理已规划

✅ **类型定义完成**：
- TypeScript 接口完整
- 类型安全已确保

## 下一步

继续 [第 3 步](step3.md)：UI 组件与用户交互

**输出确认**: "数据层设计完成 - 准备进行 UI 交互逻辑"
